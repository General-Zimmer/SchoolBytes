@model List<Course>
@{
    var selectedCourseId = ViewBag.SelectedCourseId as int?;
}

<link rel="stylesheet" href="/Content/CourseOverviewStyles.css"/>

<h1>Hold oversigt</h1>

<!-- Get all courses -->
<ul id="courseList">
    @foreach (var course in Model)
    {
        <li>
            <div>
                <!-- Form to toggle course details -->
                <form id="detail-form-@course.Id" asp-action="CourseOverview" method="get">
                    <input type="hidden" name="selectedCourseId" value="@(selectedCourseId == course.Id ? string.Empty : course.Id.ToString())"/>
                    @course.Name
                    <button type="submit" class="detail-button">
                        @if (selectedCourseId == course.Id)
                        {
                            @Html.Raw("&#9650;")
                            <!-- Up arrow when expanded -->
                        }
                        else
                        {
                            @Html.Raw("&#9660;")
                            <!-- Down arrow when collapsed -->
                        }
                    </button>
                </form>
            </div>

            @if (selectedCourseId == course.Id)
            {
                <div class="course-details">
                    <h4>@course.Name</h4>

                    <p>
                        <b>Start:</b>
                        <input type="date" name="StartDate" value="@course.StartDate.ToString("yyyy-MM-dd")" disabled/>
                    </p>
                    <p>
                        <b>Slut:</b>
                        <input type="date" name="EndDate" value="@course.EndDate.ToString("yyyy-MM-dd")" disabled/>
                    </p>
                    <p>
                        <b>Beskrivelse:</b>
                        <textarea name="Description" disabled>@course.Description</textarea>
                    </p>
                    <p>
                        <b>Maksimum antal deltagere:</b>
                        <input type="number" name="MaxCapacity" value="@course.MaxCapacity" disabled/>
                    </p>

                    <!-- Update -->
                    <form id="detail-form-@course.Id" asp-action="Update" method="post">
                        <input type="hidden" name="Id" value="@course.Id"/> 

                        <!-- Rediger Button -->
                        <button type="button" class="toggle-button" onclick="enableEditing()">Rediger hold</button>

                        <!-- Gem ændringer Button -->
                        <button type="submit" class="save-button" onclick="enableDisabled()" style="display: none;">Gem ændringer</button>
                    </form>

                    <!-- Delete -->
                    <button type="submit" class="toggle-button" onclick="return confirmDelete(@course.Id)">Slet hold</button>
                </div>

                <script>
                function confirmDelete(obj) {
                if (confirm(("Er du sikker på, at du vil slette dette hold?") === true)) {
                    $.ajax( '@Context.Request.Url.GetLeftPart(UriPartial.Authority)' + "/course/delete/" + obj ,{
                    method: 'POST',
                    data: ''})
                
                   // window.location.href = '@Url.Action("Delete", "Course")/' + obj
                }
                }
                </script>

                <script>
                function enableEditing() {
                    document.querySelectorAll('.course-details input, .course-details textarea').forEach(field => {
                        field.removeAttribute('disabled');
                    });
   
                    document.querySelector('.toggle-button').style.display = 'none';
                    document.querySelector('.save-button').style.display = 'inline-block';
                }

                function enableDisabled() {
                    document.querySelectorAll('.course-details input, .course-details textarea').forEach(field => {
                        field.setAttribute("disabled", 'disabled');
                    });
                }
            </script>
            }
        </li>
    }
</ul>

<h1>Opret hold</h1>
<!-- Create new course -->
@using (Html.BeginForm("CreateCourse", "Course", FormMethod.Post, new { @class = "create-form" }))
{
    <div class="create-group">
        <label class="create-label" for="Name">Kursusnavn:</label>
        <input class="create-input" type="text" id="Name" name="Name" required/>
    </div>

    <div class="create-group">
        <label class="create-label" for="Description">Beskrivelse:</label>
        <textarea class="create-input" id="Description" name="Description" required></textarea>
    </div>

    <div class="create-group">
        <label class="create-label" for="Teacher">Lærer:</label>
        <input class="create-input" type="text" id="Teacher" name="Teacher.Name" required/>
    </div>

    <div class="create-group">
        <label class="create-label" for="StartDate">Startdato:</label>
        <input class="create-input" type="date" id="StartDate" name="StartDate" required/>
    </div>

    <div class="create-group">
        <label class="create-label" for="EndDate">Slutdato:</label>
        <input class="create-input" type="date" id="EndDate" name="EndDate" required/>
    </div>

    <div class="create-group">
        <label class="create-label" for="MaxCapacity">Maksimal kapacitet:</label>
        <input class="create-input" type="number" id="MaxCapacity" name="MaxCapacity" min="1" required/>
    </div>

    <div class="create-group">
        <button class="create-button" type="submit">Opret nyt hold</button>
    </div>
}